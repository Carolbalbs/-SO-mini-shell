<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Explica√ß√£o da Estrutura - SO</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">SO</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Introdu√ß√£o</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Explica√ß√£o da Estrutura</a>
                            </li>
                            <li class="nav-item">
                                <a href="../chamadas/" class="nav-link">Chamadas ao Sistema</a>
                            </li>
                            <li class="nav-item">
                                <a href="../mini-Shell/" class="nav-link">Demonstra√ß√£o mini-shell</a>
                            </li>
                            <li class="nav-item">
                                <a href="../casos%20de%20uso/" class="nav-link">Casos de uso</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../chamadas/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/carolbalbs/-SO-mini-shell/edit/master/docs/estrutura.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#logica-principal-do-shell" class="nav-link">L√≥gica Principal do Shell</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#introducao" class="nav-link">Introdu√ß√£o</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#indexh-arquivo-de-cabecalho-principal" class="nav-link">index.h - Arquivo de Cabe√ßalho Principal</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#utilsc-funcoes-utilitarias-e-wrappers-de-chamadas-de-sistema" class="nav-link">utils.c - Fun√ß√µes Utilit√°rias e Wrappers de Chamadas de Sistema</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#builtinc-implementacao-de-comandos-built-in" class="nav-link">builtin.c - Implementa√ß√£o de Comandos Built-in</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#indexc-logica-principal-do-shell-repl" class="nav-link">index.c - L√≥gica Principal do Shell (REPL)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#conclusao" class="nav-link">Conclus√£o</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#limitacoes-conhecidas-da-implementacao" class="nav-link">Limita√ß√µes Conhecidas da Implementa√ß√£o</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="logica-principal-do-shell">L√≥gica Principal do Shell</h1>
<h2 id="introducao">Introdu√ß√£o</h2>
<p>Os arquivos de c√≥digo-fonte C que comp√µem a implementa√ß√£o de um shell b√°sico.</p>
<p>O projeto √© dividido em m√≥dulos, cada um com responsabilidades espec√≠ficas:</p>
<ul>
<li><code>index.h</code>: Arquivo de cabe√ßalho que cont√©m defini√ß√µes globais, macros e prot√≥tipos de fun√ß√µes.</li>
<li><code>utils.c</code>: Implementa fun√ß√µes utilit√°rias e wrappers para chamadas de sistema.</li>
<li><code>builtin.c</code>: Cont√©m a implementa√ß√£o de comandos built-in do shell.</li>
<li><code>index.c</code>: A l√≥gica principal do shell, incluindo o loop de leitura, avalia√ß√£o e execu√ß√£o de comandos (REPL).</li>
</ul>
<h2 id="indexh-arquivo-de-cabecalho-principal"><code>index.h</code> - Arquivo de Cabe√ßalho Principal</h2>
<p>O arquivo <code>index.h</code> serve como o cabe√ßalho central para o projeto do shell, definindo constantes, incluindo bibliotecas padr√£o, declarando macros e prot√≥tipos de fun√ß√µes que s√£o utilizadas em m√∫ltiplos arquivos-fonte. Ele estabelece a base para a comunica√ß√£o e a coer√™ncia entre os diferentes m√≥dulos do shell.</p>
<h3 id="constantes-e-codigos-de-saida">Constantes e C√≥digos de Sa√≠da</h3>
<p>Este cabe√ßalho define c√≥digos de sa√≠da padr√£o que s√£o utilizados em todo o projeto para indicar o status de sucesso ou falha de opera√ß√µes. Estes incluem:</p>
<ul>
<li><code>EX_OK</code>: Representa uma sa√≠da bem-sucedida, geralmente associada a <code>EXIT_SUCCESS</code>.</li>
<li><code>EX_OSERR</code>: Indica um erro de sistema operacional, como falha na cria√ß√£o de um processo (<code>fork</code>).</li>
<li><code>EX_UNAVAILABLE</code>: Sinaliza que um comando ou servi√ßo n√£o est√° dispon√≠vel, como uma falha na execu√ß√£o de um programa (<code>execvp</code>).</li>
</ul>
<h3 id="inclusoes-de-bibliotecas-padrao">Inclus√µes de Bibliotecas Padr√£o</h3>
<p>Para garantir a funcionalidade completa do shell, <code>index.h</code> inclui v√°rias bibliotecas padr√£o do C, que fornecem acesso a fun√ß√µes essenciais para manipula√ß√£o de entrada/sa√≠da, gerenciamento de mem√≥ria, opera√ß√µes de string e controle de processos:</p>
<ul>
<li><code>&lt;stdio.h&gt;</code>: Para fun√ß√µes de entrada e sa√≠da, como <code>printf</code> e <code>getline</code>.</li>
<li><code>&lt;stdlib.h&gt;</code>: Para fun√ß√µes de uso geral, como aloca√ß√£o de mem√≥ria (<code>malloc</code>, <code>realloc</code>, <code>free</code>) e controle de processos (<code>exit</code>).</li>
<li><code>&lt;unistd.h&gt;</code>: Para acesso a chamadas de sistema POSIX, como <code>fork</code>, <code>execvp</code> e <code>getcwd</code>.</li>
<li><code>&lt;string.h&gt;</code>: Para fun√ß√µes de manipula√ß√£o de strings, como <code>strcmp</code> e <code>strtok</code>.</li>
<li><code>&lt;sys/wait.h&gt;</code>: Para fun√ß√µes relacionadas ao controle de processos filhos, como <code>wait</code> e macros para verificar o status de sa√≠da de processos (<code>WIFEXITED</code>, <code>WEXITSTATUS</code>).</li>
</ul>
<h3 id="utilitarios">Utilit√°rios</h3>
<p>O arquivo <code>index.h</code> define macros que simplificam a formata√ß√£o da sa√≠da do terminal com cores ANSI e facilitam a impress√£o de mensagens. Essas macros s√£o cruciais para melhorar a legibilidade e a experi√™ncia do usu√°rio no shell:</p>
<ul>
<li><strong>Cores ANSI</strong>: Macros como <code>Y</code> (Amarelo), <code>G</code> (Verde), <code>C</code> (Ciano), <code>RED</code> (Vermelho) e <code>RST</code> (Reset) s√£o definidas para aplicar cores ao texto no terminal, tornando as mensagens de status e prompts mais visuais.</li>
</ul>
<h3 id="prototipos-de-funcoes">Prot√≥tipos de Fun√ß√µes</h3>
<p><code>index.h</code> declara os prot√≥tipos de todas as fun√ß√µes p√∫blicas que s√£o implementadas nos arquivos <code>.c</code> do projeto. Isso garante que as fun√ß√µes possam ser chamadas de outros arquivos sem problemas de compila√ß√£o. As fun√ß√µes prototipadas incluem:</p>
<ul>
<li><code>printbanner(void)</code>: Imprime um banner de boas-vindas no in√≠cio do shell.</li>
<li><code>spinnerLoading()</code>: Exibe uma anima√ß√£o de carregamento, geralmente usada antes de sair do shell.</li>
<li><code>Chdir(const char *path)</code>: Wrapper para a fun√ß√£o <code>chdir</code> (n√£o implementada nos arquivos fornecidos, mas prototipada).</li>
<li><code>Fork(void)</code>: Wrapper para a fun√ß√£o <code>fork</code>, para criar um novo processo.</li>
<li><code>Execvp(const char *file, char *const argv[])</code>: Wrapper para a fun√ß√£o <code>execvp</code>, para executar um programa.</li>
<li><code>Wait(int *status)</code>: Wrapper para a fun√ß√£o <code>wait</code>, para aguardar a conclus√£o de um processo filho.</li>
<li><code>Wait(pid_t pid, int *status, int options)</code>: Uma sobrecarga ou declara√ß√£o duplicada de <code>Wait</code>, que pode indicar uma inten√ß√£o de ter uma fun√ß√£o <code>waitpid</code> ou um erro de prototipagem.</li>
<li><code>index_exit(char **)</code>: Implementa√ß√£o do comando built-in <code>exit</code>.</li>
<li><code>Getcwd(char *, size_t)</code>: Wrapper para a fun√ß√£o <code>getcwd</code>, para obter o diret√≥rio de trabalho atual.</li>
<li><code>Malloc(size_t)</code>: Wrapper para a fun√ß√£o <code>malloc</code>, para aloca√ß√£o de mem√≥ria.</li>
<li><code>Realloc(void *ptr, size_t size)</code>: Wrapper para a fun√ß√£o <code>realloc</code>, para realoca√ß√£o de mem√≥ria.</li>
</ul>
<p>Em resumo, <code>index.h</code> √© o ponto de partida para entender a estrutura e as depend√™ncias do projeto do shell, fornecendo as defini√ß√µes e declara√ß√µes necess√°rias para que os diferentes componentes funcionem em conjunto.</p>
<h2 id="utilsc-funcoes-utilitarias-e-wrappers-de-chamadas-de-sistema"><code>utils.c</code> - Fun√ß√µes Utilit√°rias e Wrappers de Chamadas de Sistema</h2>
<p>O arquivo <code>utils.c</code> cont√©m uma cole√ß√£o de fun√ß√µes utilit√°rias e wrappers para chamadas de sistema POSIX. fun√ß√µes s√£o projetadas para encapsular a l√≥gica de tratamento de erros das chamadas de sistema subjacentes, tornando o c√≥digo principal do shell mais limpo e robusto. Em caso de falha, a maioria dessas fun√ß√µes imprime uma mensagem de erro usando <code>perror</code> e encerra o programa, garantindo que o shell n√£o continue a operar em um estado inconsistente.</p>
<h3 id="wrappers-para-gerenciamento-de-processos">Wrappers para Gerenciamento de Processos</h3>
<p>As fun√ß√µes de gerenciamento de processos em <code>utils.c</code> fornecem uma interface segura para opera√ß√µes comuns de processos, como cria√ß√£o, execu√ß√£o e espera:</p>
<ul>
<li>
<p><code>pid_t Fork(void)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Este √© um wrapper para a chamada de sistema <code>fork()</code>. Ele cria um novo processo filho que √© uma c√≥pia exata do processo pai.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>fork()</code> falhar (retornar um valor negativo), a fun√ß√£o imprime uma mensagem de erro (<code>"Fork Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EX_OSERR)</code>. Isso garante que o shell n√£o tente operar com um processo filho que n√£o foi criado corretamente.</li>
<li><strong>Retorno</strong>: Retorna o ID do processo filho (<code>pid_t</code>) para o processo pai e <code>0</code> para o processo filho, conforme o comportamento padr√£o de <code>fork()</code>.</li>
</ul>
</li>
<li>
<p><code>void Execvp(const char *file, char *const argv[])</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Este wrapper para <code>execvp()</code> substitui a imagem do processo atual por um novo programa. Ele procura o execut√°vel especificado por <code>file</code> nos diret√≥rios listados na vari√°vel de ambiente <code>PATH</code>.</li>
<li><strong>Comportamento em Erro</strong>: Antes de chamar <code>execvp()</code>, a fun√ß√£o verifica se <code>file</code> ou <code>argv</code> s√£o nulos. Se forem, imprime uma mensagem de erro no <code>stderr</code> e encerra com <code>exit(EXIT_FAILURE)</code>. Se <code>execvp()</code> falhar (retornar <code>-1</code>), imprime uma mensagem de erro (<code>"Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EX_UNAVAILABLE)</code>. Isso √© crucial porque <code>execvp()</code> s√≥ retorna em caso de erro; um retorno bem-sucedido significa que o novo programa est√° em execu√ß√£o.</li>
<li><strong>Argumentos</strong>: <code>file</code> √© o nome do programa a ser executado, e <code>argv</code> √© um array de strings que representa os argumentos da linha de comando para o novo programa, onde <code>argv[0]</code> √© o nome do programa.</li>
</ul>
</li>
<li>
<p><code>pid_t Wait(int *status)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Este wrapper para <code>wait()</code> suspende a execu√ß√£o do processo pai at√© que um de seus processos filhos termine. Ele √© usado para coletar o status de sa√≠da de processos filhos e evitar processos zumbis.</li>
<li><strong>Comportamento em Erro</strong>: A fun√ß√£o primeiro verifica se o ponteiro <code>status</code> √© nulo. Se for, imprime uma mensagem de erro (<code>"Wait: status argument required"</code>) e retorna <code>-1</code>. Se <code>wait()</code> falhar (retornar <code>-1</code>), imprime uma mensagem de erro (<code>"Wait failed"</code>) usando <code>perror</code>. Ap√≥s a conclus√£o bem-sucedida de <code>wait()</code>, se o processo filho terminou normalmente (<code>WIFEXITED(*status)</code>), o status de sa√≠da real do filho (<code>WEXITSTATUS(*status)</code>) √© armazenado em <code>*status</code>.</li>
<li><strong>Retorno</strong>: Retorna o ID do processo filho que terminou ou <code>-1</code> em caso de erro.</li>
</ul>
</li>
</ul>
<h3 id="wrappers-para-gerenciamento-de-memoria">Wrappers para Gerenciamento de Mem√≥ria</h3>
<p>As fun√ß√µes de gerenciamento de mem√≥ria em <code>utils.c</code> fornecem aloca√ß√£o e realoca√ß√£o de mem√≥ria seguras, com tratamento de erros integrado:</p>
<ul>
<li>
<p><code>void *Malloc(size_t size)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Este wrapper para <code>malloc()</code> aloca um bloco de mem√≥ria do tamanho especificado.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>malloc()</code> falhar (retornar <code>NULL</code>), a fun√ß√£o imprime uma mensagem de erro (<code>"Malloc Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EXIT_FAILURE)</code>. Um caso especial √© quando <code>size</code> √© <code>0</code>, para o qual <code>Malloc</code> retorna <code>NULL</code> sem erro, seguindo o comportamento comum de <code>malloc</code> para aloca√ß√µes de tamanho zero.</li>
<li><strong>Retorno</strong>: Retorna um ponteiro para o bloco de mem√≥ria alocado ou <code>NULL</code> se <code>size</code> for <code>0</code>.</li>
</ul>
</li>
<li>
<p><code>void *Realloc(void *ptr, size_t size)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Este wrapper para <code>realloc()</code> redimensiona o bloco de mem√≥ria apontado por <code>ptr</code> para o novo <code>size</code>.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>realloc()</code> falhar (retornar <code>NULL</code>) e o <code>size</code> n√£o for <code>0</code>, a fun√ß√£o imprime uma mensagem de erro (<code>"Realloc Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EXIT_FAILURE)</code>. Se <code>size</code> for <code>0</code>, <code>realloc</code> se comporta como <code>free(ptr)</code>, e a fun√ß√£o retorna <code>NULL</code> sem erro, o que √© um comportamento v√°lido.</li>
<li><strong>Retorno</strong>: Retorna um ponteiro para o bloco de mem√≥ria redimensionado ou <code>NULL</code> se a realoca√ß√£o falhar ou se <code>size</code> for <code>0</code>.</li>
</ul>
</li>
</ul>
<h3 id="wrappers-para-operacoes-de-diretorio">Wrappers para Opera√ß√µes de Diret√≥rio</h3>
<p><code>utils.c</code> inclui um wrapper para obter o diret√≥rio de trabalho atual:</p>
<ul>
<li><code>void Getcwd(char *buf, size_t size)</code>:<ul>
<li><strong>Prop√≥sito</strong>: Este wrapper para <code>getcwd()</code> copia o caminho absoluto do diret√≥rio de trabalho atual para o buffer <code>buf</code>.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>getcwd()</code> falhar (retornar <code>NULL</code>), a fun√ß√£o imprime uma mensagem de erro (<code>"getcwd FAILED"</code>) usando <code>perror</code>.</li>
<li><strong>Argumentos</strong>: <code>buf</code> √© o buffer onde o caminho ser√° armazenado, e <code>size</code> √© o tamanho m√°ximo do buffer.</li>
</ul>
</li>
</ul>
<h3 id="funcoes-de-interface-do-usuario">Fun√ß√µes de Interface do Usu√°rio</h3>
<p>Al√©m dos wrappers, <code>utils.c</code> tamb√©m cont√©m fun√ß√µes para melhorar a experi√™ncia do usu√°rio com elementos visuais:</p>
<ul>
<li>
<p><code>void printbanner(void)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Imprime um banner ASCII art no console. Este banner √© exibido no in√≠cio do shell, fornecendo uma sauda√ß√£o visual.</li>
<li><strong>Implementa√ß√£o</strong>: Utiliza a macro <code>p</code> (que envolve <code>printf</code>) e c√≥digos de cores ANSI (definidos em <code>index.h</code>) para exibir o banner com formata√ß√£o colorida.</li>
</ul>
</li>
<li>
<p><code>void spinnerLoading()</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Exibe uma anima√ß√£o de "carregamento" ou "desligamento" no console, simulando um processo em andamento antes de o shell ser encerrado.</li>
<li><strong>Implementa√ß√£o</strong>: A fun√ß√£o usa um array de strings (<code>charging[]</code>) para representar os diferentes quadros da anima√ß√£o de um spinner. Ela itera sobre esses quadros, imprimindo cada um com um atraso (<code>usleep</code>) e for√ßando a atualiza√ß√£o do console (<code>fflush(stdout)</code>). No final da anima√ß√£o, imprime uma mensagem de sa√≠da e encerra o programa com <code>exit(X_OK)</code> (onde <code>X_OK</code> √© uma constante definida em <code>index.h</code> como <code>EX_OK</code>).</li>
</ul>
</li>
</ul>
<p>Em resumo, <code>utils.c</code> √© um componente vital do shell, fornecendo uma camada de abstra√ß√£o e tratamento de erros para opera√ß√µes de baixo n√≠vel, o que contribui significativamente para a robustez e a confiabilidade do sistema.</p>
<h2 id="builtinc-implementacao-de-comandos-built-in"><code>builtin.c</code> - Implementa√ß√£o de Comandos Built-in</h2>
<p>O arquivo <code>builtin.c</code> √© respons√°vel por implementar os comandos built-in do shell que s√£o fun√ß√µes que s√£o executadas diretamente pelo shell, em vez de serem programas externos. e n√£o exigem a cria√ß√£o de um novo processo.   Este projeto cont√©m as implementa√ß√µes para os comandos <code>exit</code> e <code>env</code>.</p>
<h3 id="int-index_exitchar-args"><code>int index_exit(char **args)</code></h3>
<ul>
<li><strong>Prop√≥sito</strong>: Implementa o comando <code>exit</code>, que encerra a execu√ß√£o do shell.</li>
<li><strong>Funcionalidade</strong>: Antes de sair, a fun√ß√£o chama <code>spinnerLoading()</code>, que exibe uma anima√ß√£o de desligamento, proporcionando uma experi√™ncia de usu√°rio mais agrad√°vel. Ap√≥s a anima√ß√£o, o shell √© encerrado com <code>exit(EXIT_SUCCESS)</code>, indicando uma sa√≠da bem-sucedida.</li>
</ul>
<h3 id="int-index_envchar-args"><code>int index_env(char **args)</code></h3>
<ul>
<li><strong>Prop√≥sito</strong>: Implementa o comando <code>env</code>, que exibe as vari√°veis de ambiente do processo atual.</li>
<li><strong>Funcionalidade</strong>: A fun√ß√£o acessa a vari√°vel global <code>environ</code> (declarada como <code>extern char **environ;</code>), que √© um ponteiro para um array de strings, onde cada string representa uma vari√°vel de ambiente no formato <code>NOME=VALOR</code>. A fun√ß√£o itera sobre este array e imprime cada vari√°vel de ambiente em uma nova linha usando a macro <code>p</code> (que envolve <code>printf</code>).</li>
</ul>
<h3 id="int-cell_echochar-args"><code>int cell_echo(char **args)</code></h3>
<ul>
<li><strong>Prop√≥sito</strong>: Implementa o comando <code>echo</code>, que imprime os argumentos fornecidos na sa√≠da padr√£o. Suporta a op√ß√£o <code>-n</code> para suprimir a nova linha final.</li>
<li><strong>Funcionalidade</strong>: A fun√ß√£o verifica se o segundo argumento (<code>args[1]</code>) √© <code>"-n"</code>. Se for, a flag <code>newline</code> √© definida como <code>false</code> e o √≠ndice de in√≠cio para a impress√£o dos argumentos √© ajustado para <code>2</code> (pulando <code>echo</code> e <code>-n</code>). Caso contr√°rio, a impress√£o come√ßa do √≠ndice <code>1</code>. A fun√ß√£o ent√£o itera sobre os argumentos restantes, imprimindo cada um. Um espa√ßo √© adicionado entre os argumentos. Finalmente, se a flag <code>newline</code> for <code>true</code>, uma nova linha √© impressa.</li>
</ul>
<p>Este arquivo centraliza a l√≥gica para comandos que s√£o parte integrante do shell, garantindo que eles sejam executados de forma eficiente e com o comportamento esperado.</p>
<h2 id="indexc-logica-principal-do-shell-repl"><code>index.c</code> - L√≥gica Principal do Shell (REPL)</h2>
<p>O arquivo <code>index.c</code> cont√©m a l√≥gica central do shell, implementando o ciclo REPL (Read-Evaluate-Print/Execute-Loop). Este ciclo √© o cora√ß√£o de qualquer shell interativo, onde o programa l√™ a entrada do usu√°rio, a processa, executa o comando correspondente e repete o processo. Al√©m do REPL, <code>index.c</code> gerencia a execu√ß√£o de comandos built-in e externos, bem como a divis√£o da linha de comando em argumentos.</p>
<h3 id="variaveis-globais">Vari√°veis Globais</h3>
<ul>
<li><code>int status = 0;</code>:<ul>
<li><strong>Prop√≥sito</strong>: Esta vari√°vel global armazena o status de sa√≠da do √∫ltimo comando executado. √â um padr√£o comum em shells para que o status de sa√≠da possa ser consultado por comandos subsequentes ou scripts.</li>
</ul>
</li>
</ul>
<h3 id="funcoes-de-execucao-de-comandos">Fun√ß√µes de Execu√ß√£o de Comandos</h3>
<ul>
<li>
<p><code>void index_launch(char **args)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Esta fun√ß√£o √© respons√°vel por lan√ßar a execu√ß√£o de comandos externos (n√£o built-in).</li>
<li><strong>Funcionalidade</strong>: Ela utiliza o wrapper <code>Fork()</code> para criar um novo processo filho. Se for o processo filho (<code>INDEX_jr</code> √© 0, conforme definido em <code>index.h</code>), ele chama <code>Execvp(args[0], args)</code> para substituir a imagem do processo filho pelo programa especificado em <code>args[0]</code> com seus respectivos argumentos. Se for o processo pai, ele chama <code>Wait(&amp;status)</code> para aguardar a conclus√£o do processo filho e coletar seu status de sa√≠da, que √© armazenado na vari√°vel global <code>status</code>.</li>
<li><strong>Fluxo de Controle</strong>: Esta fun√ß√£o √© crucial para a capacidade do shell de executar programas externos, como <code>ls</code>, <code>grep</code>, etc.</li>
</ul>
</li>
<li>
<p><code>void index_exec(char **args)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Esta √© a fun√ß√£o principal para a execu√ß√£o de comandos, atuando como um despachante para comandos built-in e externos.</li>
<li><strong>Funcionalidade</strong>: A fun√ß√£o itera sobre a estrutura global <code>g_builtin</code> (definida em <code>index.c</code> e populada com os comandos built-in). Para cada entrada em <code>g_builtin</code>, ela compara o nome do comando built-in (<code>g_builtin[i].builtin_name</code>) com o primeiro argumento da linha de comando (<code>args[0]</code>) usando <code>strcmp</code>. Se uma correspond√™ncia for encontrada, a fun√ß√£o associada ao built-in (<code>g_builtin[i].foo</code>) √© chamada com os argumentos, e o valor de retorno (status de sa√≠da do built-in) √© armazenado na vari√°vel global <code>status</code>. Ap√≥s a execu√ß√£o do built-in, a fun√ß√£o retorna.</li>
<li><strong>Comandos Built-in</strong>: A estrutura <code>g_builtin</code> √© um array de <code>t_builtin</code> (definido em <code>index.h</code>), que mapeia nomes de comandos para ponteiros de fun√ß√£o. Atualmente, inclui <code>env</code> e <code>exit</code>. A linha comentada <code>{.builtin_name ="echo", .foo=index_echo};</code> sugere que <code>echo</code> foi considerado ou pode ser adicionado no futuro.</li>
<li><strong>Execu√ß√£o de Comandos Externos</strong>: Se nenhum comando built-in corresponder ao <code>args[0]</code>, a fun√ß√£o <code>index_launch(args)</code> √© chamada para tentar executar o comando como um programa externo.</li>
</ul>
</li>
</ul>
<h3 id="funcoes-de-processamento-de-entrada">Fun√ß√µes de Processamento de Entrada</h3>
<ul>
<li>
<p><code>char **index_split_line(char *line)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Esta fun√ß√£o √© respons√°vel por tokenizar a linha de entrada do usu√°rio em argumentos individuais.</li>
<li><strong>Funcionalidade</strong>: Ela utiliza a fun√ß√£o <code>strtok</code> para dividir a string <code>line</code> em tokens, usando os delimitadores definidos pela macro <code>DEL</code> (espa√ßo, tabula√ß√£o, nova linha, etc.). A fun√ß√£o aloca dinamicamente mem√≥ria para armazenar os ponteiros para esses tokens. Se a capacidade do buffer for excedida, <code>Realloc</code> √© usado para dobrar o tamanho do buffer, garantindo que todos os tokens possam ser armazenados. O array de tokens √© terminado com <code>NULL</code>, o que √© um padr√£o comum para arrays de strings em C.</li>
<li><strong>Gerenciamento de Mem√≥ria</strong>: A mem√≥ria para os tokens √© alocada usando <code>Malloc</code> e <code>Realloc</code>, garantindo tratamento de erros para falhas de aloca√ß√£o.</li>
<li><strong>Retorno</strong>: Retorna um array de strings (<code>char **</code>) onde cada string √© um argumento da linha de comando.</li>
</ul>
</li>
<li>
<p><code>char *index_read_line(void)</code>:</p>
<ul>
<li><strong>Prop√≥sito</strong>: Esta fun√ß√£o l√™ uma linha de entrada do usu√°rio do <code>stdin</code>.</li>
<li><strong>Funcionalidade</strong>: Ela exibe um prompt para o usu√°rio, que inclui o diret√≥rio de trabalho atual (obtido via <code>Getcwd</code>) e um caractere de shell (<code>üêö</code>). Em seguida, usa <code>getline</code> para ler a linha completa, incluindo espa√ßos, at√© que uma nova linha seja encontrada ou o final do arquivo seja atingido. <code>getline</code> aloca dinamicamente o buffer <code>buf</code> conforme necess√°rio.</li>
<li><strong>Tratamento de Erros</strong>: Se <code>getline</code> falhar (retornar <code>-1</code>), a fun√ß√£o libera o buffer alocado e verifica se o final do arquivo (<code>feof(stdin)</code>) foi atingido. Se sim, imprime <code>"[EOF]"</code>; caso contr√°rio, imprime <code>"getline failed"</code>.</li>
<li><strong>Retorno</strong>: Retorna um ponteiro para a string lida ou <code>NULL</code> em caso de erro ou final de arquivo.</li>
</ul>
</li>
</ul>
<h3 id="funcao-principal-main">Fun√ß√£o Principal (<code>main</code>)</h3>
<ul>
<li><code>int main()</code>:<ul>
<li><strong>Prop√≥sito</strong>: A fun√ß√£o <code>main</code> √© o ponto de entrada do programa shell e implementa o loop REPL.</li>
<li><strong>Fluxo de Execu√ß√£o</strong>: <ol>
<li><strong>Banner</strong>: Chama <code>printbanner()</code> para exibir uma mensagem de boas-vindas no in√≠cio.</li>
<li><strong>Loop REPL</strong>: Entra em um loop infinito (<code>while((line = index_read_line()))</code>) que continua enquanto <code>index_read_line()</code> retornar uma linha v√°lida (ou seja, n√£o <code>NULL</code>).</li>
<li><strong>Leitura (Read)</strong>: Dentro do loop, <code>index_read_line()</code> √© chamada para obter a entrada do usu√°rio, exibindo o prompt e lendo a linha.</li>
<li><strong>Avalia√ß√£o/Tokeniza√ß√£o (Evaluate/Lexing/Parsing)</strong>: A linha lida √© ent√£o passada para <code>index_split_line(line)</code> para ser tokenizada em argumentos.</li>
<li><strong>Execu√ß√£o (Execute)</strong>: Os argumentos tokenizados s√£o passados para <code>index_exec(args)</code>, que decide se o comando √© um built-in ou um programa externo e o executa.</li>
<li><strong>Libera√ß√£o de Mem√≥ria (Free)</strong>: Ap√≥s a execu√ß√£o do comando, a mem√≥ria alocada para a linha (<code>line</code>) e os argumentos (<code>args</code>) √© liberada usando <code>free()</code>, prevenindo vazamentos de mem√≥ria.</li>
<li><strong>Loop (Loop)</strong>: O ciclo se repete, solicitando uma nova entrada do usu√°rio.</li>
</ol>
</li>
<li><strong>Sa√≠da</strong>: O loop termina quando <code>index_read_line()</code> retorna <code>NULL</code> (indicando EOF ou um erro fatal). O programa ent√£o retorna <code>EXIT_SUCCESS</code>.</li>
</ul>
</li>
</ul>
<h3 id="estrutura-g_builtin">Estrutura <code>g_builtin</code></h3>
<pre><code class="language-c">t_builtin g_builtin[] = {
 //   {.builtin_name =&quot;echo&quot;, .foo=index_echo};
    {.builtin_name =&quot;env&quot;, .foo=index_env};
    {.builtin_name =&quot;exit&quot;, .foo=index_exit},
    {.builtin_name =NULL}

};
</code></pre>
<ul>
<li><strong>Prop√≥sito</strong>: Esta √© uma vari√°vel global que armazena a lista de comandos built-in que o shell suporta. √â um array de estruturas <code>t_builtin</code>, onde cada elemento associa o nome de um comando built-in a um ponteiro para a fun√ß√£o que o implementa.</li>
<li><strong>Extensibilidade</strong>: A estrutura √© terminada com um elemento <code>NULL</code>, permitindo que o shell itere sobre ela para encontrar o comando built-in correto. Novas fun√ß√µes built-in podem ser adicionadas a este array para estender a funcionalidade do shell.</li>
</ul>
<p>Em resumo, <code>index.c</code> orquestra o fluxo de trabalho do shell, desde a intera√ß√£o com o usu√°rio at√© a execu√ß√£o de comandos, garantindo que o shell funcione como um ambiente de linha de comando interativo e responsivo.</p>
<h2 id="conclusao">Conclus√£o</h2>
<p>O projeto de shell em C analisado demonstra uma implementa√ß√£o funcional de um interpretador de linha de comando b√°sico. A arquitetura modular, com responsabilidades bem definidas para cada arquivo (<code>index.h</code>, <code>utils.c</code>, <code>builtin.c</code>, <code>index.c</code>), contribui para a clareza e manutenibilidade do c√≥digo.</p>
<p>Os principais recursos implementados incluem:</p>
<ul>
<li><strong>Loop REPL</strong>: O shell l√™ comandos do usu√°rio, os avalia e os executa, repetindo o ciclo.</li>
<li><strong>Execu√ß√£o de Comandos Externos</strong>: Capacidade de executar programas do sistema operacional atrav√©s de <code>fork</code> e <code>execvp</code>.</li>
<li><strong>Comandos Built-in</strong>: Implementa√ß√£o de comandos internos como <code>exit</code> e <code>env</code>, que s√£o executados diretamente pelo shell para maior efici√™ncia.</li>
<li><strong>Tokeniza√ß√£o de Linha de Comando</strong>: A entrada do usu√°rio √© dividida em tokens (comandos e argumentos) para processamento.</li>
<li><strong>Gerenciamento de Processos</strong>: Utiliza√ß√£o de <code>fork</code>, <code>execvp</code> e <code>wait</code> para criar e gerenciar processos filhos.</li>
<li><strong>Gerenciamento de Mem√≥ria</strong>: Uso de <code>malloc</code> e <code>realloc</code> com wrappers para tratamento de erros, garantindo aloca√ß√£o e realoca√ß√£o de mem√≥ria seguras.</li>
<li><strong>Interface de Usu√°rio Aprimorada</strong>: Uso de cores ANSI para prompts e mensagens, al√©m de um banner de boas-vindas e uma anima√ß√£o de desligamento.</li>
</ul>
<p>O c√≥digo demonstra boas pr√°ticas de programa√ß√£o em C, como o uso de wrappers para chamadas de sistema para centralizar o tratamento de erros e a libera√ß√£o de mem√≥ria alocada dinamicamente para evitar vazamentos.</p>
<h3 id="possiveis-melhorias-e-extensoes">Poss√≠veis Melhorias e Extens√µes</h3>
<p>Embora funcional, o shell pode ser estendido com recursos adicionais para torn√°-lo mais robusto e completo, como:</p>
<ul>
<li><strong>Redirecionamento de Entrada/Sa√≠da</strong>: Implementar operadores como <code>&gt;</code>, <code>&lt;</code>, <code>&gt;&gt;</code> e <code>|</code> (pipes).</li>
<li><strong>Tratamento de Sinais</strong>: Melhorar o tratamento de sinais como <code>SIGINT</code> (Ctrl+C) e <code>SIGTSTP</code> (Ctrl+Z).</li>
<li><strong>Vari√°veis de Shell</strong>: Permitir a defini√ß√£o e o uso de vari√°veis de ambiente locais ao shell.</li>
<li><strong>Hist√≥rico de Comandos</strong>: Implementar um hist√≥rico de comandos naveg√°vel.</li>
<li><strong>Autocompletar</strong>: Adicionar funcionalidade de autocompletar para comandos e nomes de arquivos.</li>
<li><strong>Aliases</strong>: Permitir a cria√ß√£o de aliases para comandos.</li>
<li><strong>Jobs em Background</strong>: Suporte para executar comandos em segundo plano (usando <code>&amp;</code>).</li>
<li><strong>Scripting</strong>: Capacidade de executar scripts de shell.</li>
</ul>
<h2 id="limitacoes-conhecidas-da-implementacao">Limita√ß√µes Conhecidas da Implementa√ß√£o</h2>
<p>Esta vers√£o do mini-shell possui algumas limita√ß√µes:</p>
<ul>
<li><strong>Comandos Built-in Fixos</strong>: A lista de comandos built-in (<code>env</code>, <code>exit</code>, <code>echo</code>) √© fixa e n√£o pode ser estendida dinamicamente em tempo de execu√ß√£o.</li>
<li><strong>Aus√™ncia de Vari√°veis de Ambiente do Shell</strong>: N√£o h√° suporte para vari√°veis de ambiente internas do shell (ex: <code>$PATH</code>, <code>$HOME</code>) que podem ser definidas e usadas dentro do shell.</li>
<li><strong>Sem Hist√≥rico de Comandos</strong>: N√£o h√° funcionalidade de hist√≥rico de comandos (setas para cima/baixo).</li>
<li><strong>Sem Autocompletar</strong>: N√£o h√° suporte para autocompletar nomes de arquivos ou comandos.</li>
<li><strong>Tratamento B√°sico de Erros</strong>: Embora <code>perror</code> seja usado para erros de chamadas de sistema, o tratamento de erros para comandos n√£o encontrados √© gen√©rico ("Command not found") e n√£o fornece detalhes espec√≠ficos sobre o motivo da falha (ex: permiss√£o negada, comando inexistente).</li>
<li><strong>Aus√™ncia de Comandos Complexos</strong>: N√£o h√° suporte para estruturas de controle de fluxo (if, for, while), execu√ß√£o em segundo plano (<code>&amp;</code>), ou encadeamento de comandos com <code>&amp;&amp;</code> ou <code>||</code>.</li>
<li><strong>Gerenciamento de Jobs</strong>: N√£o h√° suporte para gerenciamento de jobs (suspender, retomar processos).</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
