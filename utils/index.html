<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Funções Utilitárias e Wrappers de Chamadas de Sistema - SO</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">SO</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Introdução</a>
                            </li>
                            <li class="nav-item">
                                <a href="../estrutura/" class="nav-link">Explicação da Estrutura</a>
                            </li>
                            <li class="nav-item">
                                <a href="../chamadas/" class="nav-link">Chamadas ao Sistema</a>
                            </li>
                            <li class="nav-item">
                                <a href="../mini-Shell/" class="nav-link">Demonstração mini-shell</a>
                            </li>
                            <li class="nav-item">
                                <a href="../casos%20de%20uso/" class="nav-link">Casos de uso</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/carolbalbs/-SO-mini-shell/edit/master/docs/utils.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#funcoes-utilitarias-e-wrappers-de-chamadas-de-sistema" class="nav-link">Funções Utilitárias e Wrappers de Chamadas de Sistema</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#utilsc" class="nav-link">utils.c</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="funcoes-utilitarias-e-wrappers-de-chamadas-de-sistema">Funções Utilitárias e Wrappers de Chamadas de Sistema</h1>
<h2 id="utilsc"><code>utils.c</code></h2>
<p>O arquivo <code>utils.c</code> contém uma coleção de funções utilitárias e wrappers para chamadas de sistema POSIX. Essas funções são projetadas para encapsular a lógica de tratamento de erros das chamadas de sistema subjacentes, tornando o código principal do shell mais limpo e robusto. Em caso de falha, a maioria dessas funções imprime uma mensagem de erro usando <code>perror</code> e encerra o programa, garantindo que o shell não continue a operar em um estado inconsistente.</p>
<h3 id="wrappers-para-gerenciamento-de-processos">Wrappers para Gerenciamento de Processos</h3>
<p>As funções de gerenciamento de processos em <code>utils.c</code> fornecem uma interface segura para operações comuns de processos, como criação, execução e espera:</p>
<ul>
<li>
<p><code>pid_t Fork(void)</code>:</p>
<ul>
<li><strong>Propósito</strong>: Este é um wrapper para a chamada de sistema <code>fork()</code>. Ele cria um novo processo filho que é uma cópia exata do processo pai.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>fork()</code> falhar (retornar um valor negativo), a função imprime uma mensagem de erro (<code>"Fork Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EX_OSERR)</code>. Isso garante que o shell não tente operar com um processo filho que não foi criado corretamente.</li>
<li><strong>Retorno</strong>: Retorna o ID do processo filho (<code>pid_t</code>) para o processo pai e <code>0</code> para o processo filho, conforme o comportamento padrão de <code>fork()</code>.</li>
</ul>
</li>
<li>
<p><code>void Execvp(const char *file, char *const argv[])</code>:</p>
<ul>
<li><strong>Propósito</strong>: Este wrapper para <code>execvp()</code> substitui a imagem do processo atual por um novo programa. Ele procura o executável especificado por <code>file</code> nos diretórios listados na variável de ambiente <code>PATH</code>.</li>
<li><strong>Comportamento em Erro</strong>: Antes de chamar <code>execvp()</code>, a função verifica se <code>file</code> ou <code>argv</code> são nulos. Se forem, imprime uma mensagem de erro no <code>stderr</code> e encerra com <code>exit(EXIT_FAILURE)</code>. Se <code>execvp()</code> falhar (retornar <code>-1</code>), imprime uma mensagem de erro (<code>"Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EX_UNAVAILABLE)</code>. Isso é crucial porque <code>execvp()</code> só retorna em caso de erro; um retorno bem-sucedido significa que o novo programa está em execução.</li>
<li><strong>Argumentos</strong>: <code>file</code> é o nome do programa a ser executado, e <code>argv</code> é um array de strings que representa os argumentos da linha de comando para o novo programa, onde <code>argv[0]</code> é o nome do programa.</li>
</ul>
</li>
<li>
<p><code>pid_t Wait(int *status)</code>:</p>
<ul>
<li><strong>Propósito</strong>: Este wrapper para <code>wait()</code> suspende a execução do processo pai até que um de seus processos filhos termine. Ele é usado para coletar o status de saída de processos filhos e evitar processos zumbis.</li>
<li><strong>Comportamento em Erro</strong>: A função primeiro verifica se o ponteiro <code>status</code> é nulo. Se for, imprime uma mensagem de erro (<code>"Wait: status argument required"</code>) e retorna <code>-1</code>. Se <code>wait()</code> falhar (retornar <code>-1</code>), imprime uma mensagem de erro (<code>"Wait failed"</code>) usando <code>perror</code>. Após a conclusão bem-sucedida de <code>wait()</code>, se o processo filho terminou normalmente (<code>WIFEXITED(*status)</code>), o status de saída real do filho (<code>WEXITSTATUS(*status)</code>) é armazenado em <code>*status</code>.</li>
<li><strong>Retorno</strong>: Retorna o ID do processo filho que terminou ou <code>-1</code> em caso de erro.</li>
</ul>
</li>
</ul>
<h3 id="wrappers-para-gerenciamento-de-memoria">Wrappers para Gerenciamento de Memória</h3>
<p>As funções de gerenciamento de memória em <code>utils.c</code> fornecem alocação e realocação de memória seguras, com tratamento de erros integrado:</p>
<ul>
<li>
<p><code>void *Malloc(size_t size)</code>:</p>
<ul>
<li><strong>Propósito</strong>: Este wrapper para <code>malloc()</code> aloca um bloco de memória do tamanho especificado.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>malloc()</code> falhar (retornar <code>NULL</code>), a função imprime uma mensagem de erro (<code>"Malloc Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EXIT_FAILURE)</code>. Um caso especial é quando <code>size</code> é <code>0</code>, para o qual <code>Malloc</code> retorna <code>NULL</code> sem erro, seguindo o comportamento comum de <code>malloc</code> para alocações de tamanho zero.</li>
<li><strong>Retorno</strong>: Retorna um ponteiro para o bloco de memória alocado ou <code>NULL</code> se <code>size</code> for <code>0</code>.</li>
</ul>
</li>
<li>
<p><code>void *Realloc(void *ptr, size_t size)</code>:</p>
<ul>
<li><strong>Propósito</strong>: Este wrapper para <code>realloc()</code> redimensiona o bloco de memória apontado por <code>ptr</code> para o novo <code>size</code>.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>realloc()</code> falhar (retornar <code>NULL</code>) e o <code>size</code> não for <code>0</code>, a função imprime uma mensagem de erro (<code>"Realloc Failed"</code>) usando <code>perror</code> e encerra o programa com <code>exit(EXIT_FAILURE)</code>. Se <code>size</code> for <code>0</code>, <code>realloc</code> se comporta como <code>free(ptr)</code>, e a função retorna <code>NULL</code> sem erro, o que é um comportamento válido.</li>
<li><strong>Retorno</strong>: Retorna um ponteiro para o bloco de memória redimensionado ou <code>NULL</code> se a realocação falhar ou se <code>size</code> for <code>0</code>.</li>
</ul>
</li>
</ul>
<h3 id="wrappers-para-operacoes-de-diretorio">Wrappers para Operações de Diretório</h3>
<p><code>utils.c</code> inclui um wrapper para obter o diretório de trabalho atual:</p>
<ul>
<li><code>void Getcwd(char *buf, size_t size)</code>:<ul>
<li><strong>Propósito</strong>: Este wrapper para <code>getcwd()</code> copia o caminho absoluto do diretório de trabalho atual para o buffer <code>buf</code>.</li>
<li><strong>Comportamento em Erro</strong>: Se <code>getcwd()</code> falhar (retornar <code>NULL</code>), a função imprime uma mensagem de erro (<code>"getcwd FAILED"</code>) usando <code>perror</code>.</li>
<li><strong>Argumentos</strong>: <code>buf</code> é o buffer onde o caminho será armazenado, e <code>size</code> é o tamanho máximo do buffer.</li>
</ul>
</li>
</ul>
<h3 id="funcoes-de-interface-do-usuario">Funções de Interface do Usuário</h3>
<p>Além dos wrappers, <code>utils.c</code> também contém funções para melhorar a experiência do usuário com elementos visuais:</p>
<ul>
<li>
<p><code>void printbanner(void)</code>:</p>
<ul>
<li><strong>Propósito</strong>: Imprime um banner ASCII art no console. Este banner é exibido no início do shell, fornecendo uma saudação visual.</li>
<li><strong>Implementação</strong>: Utiliza a macro <code>p</code> (que envolve <code>printf</code>) e códigos de cores ANSI (definidos em <code>index.h</code>) para exibir o banner com formatação colorida.</li>
</ul>
</li>
<li>
<p><code>void spinnerLoading()</code>:</p>
<ul>
<li><strong>Propósito</strong>: Exibe uma animação de "carregamento" ou "desligamento" no console, simulando um processo em andamento antes de o shell ser encerrado.</li>
<li><strong>Implementação</strong>: A função usa um array de strings (<code>charging[]</code>) para representar os diferentes quadros da animação de um spinner. Ela itera sobre esses quadros, imprimindo cada um com um atraso (<code>usleep</code>) e forçando a atualização do console (<code>fflush(stdout)</code>). No final da animação, imprime uma mensagem de saída e encerra o programa com <code>exit(X_OK)</code> (onde <code>X_OK</code> é uma constante definida em <code>index.h</code> como <code>EX_OK</code>).</li>
</ul>
</li>
</ul>
<p>Em resumo, <code>utils.c</code> é um componente vital do shell, fornecendo uma camada de abstração e tratamento de erros para operações de baixo nível, o que contribui significativamente para a robustez e a confiabilidade do sistema.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
